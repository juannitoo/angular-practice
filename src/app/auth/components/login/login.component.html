<section>

  <h1>Connexion / Inscription</h1>
  <p class="p-footer">J'ai essayé de faire un formulaire de connexion / inscription de qualité professionnelle, il ne manque qu'un validateur asyncrone
    pour tester la présence du mail saisie dans la base de donnée avant validation lors de l'inscription pour que j'en sois satisfait. 
    J'aurais pu forcer un mot de passe plus compliqué avec par exemple des caractères spéciaux obligatoires mais j'aurais été ennuyé à chaque saisie 
    donc pour l'instant je fais sans.
  </p>
  <p class="p-intro">Vous pouvez vous inscrire avec vos propres identifiants, et également vous connecter et vous déconnecter en utilisant les identifiants ci-dessous.</p>
  <p class="p-intro"><span class="span">test@test.fr</span> <span class="span">12345</span></p>
  
  <div class="form-card">
    
    <div class="connexion" (click)="onChooseForm('connexion')"
      [ngClass]="{ white: buttonValue==='Se connecter'}"><p>Connexion</p>
    </div>

    <div class="inscription" (click)="onChooseForm('inscription')"
      [ngClass]="{ white: buttonValue==='S\'inscrire'}"><p>Inscription</p>
    </div>
    
    <form [formGroup]="signUpForm" (submit)="onSubmitForm()">


      <mat-form-field  appearance="fill" class="form-group">
        <mat-label for="email">Email :</mat-label>
        <input matInput type="text" class="input-text" id="email" formControlName="email">
        <mat-error>Ce champ est requis, par ex: x@x.x</mat-error>
      </mat-form-field>

      <ng-container *ngIf="buttonValue === 'Se connecter'; else templateB" >
        <mat-form-field  appearance="fill" class="form-group">
          <mat-label for="connectionPassword">Mot de passe :</mat-label>
          <input matInput [type]="hideConnectionPassword ? 'password' : 'text'" 
            class="input-text" id="connectionPassword" 
            formControlName="connectionPassword"
          >
          <mat-icon matSuffix (click)="hideConnectionPassword = !hideConnectionPassword"
            >{{hideConnectionPassword ? 'visibility_off' : 'visibility'}}
          </mat-icon>
          <mat-error>Ce champ est requis, minimum 5 caractères</mat-error>
        </mat-form-field>
      </ng-container>

      <ng-template #templateB>
        <mat-form-field appearance="fill" class="form-group" [formGroup]="passwordForm">
          <mat-label for="password">Mot de passe :</mat-label>
          <input matInput [type]="hidePassword ? 'password' : 'text'" 
            class="input-text" class="input-text" id="password" 
            formControlName="password"
          >
          <mat-icon matSuffix (click)="hidePassword = !hidePassword">
            {{hidePassword ? 'visibility_off' : 'visibility'}}
          </mat-icon>
          <mat-error>Ce champ est requis, minimum 5 caractères</mat-error>
        </mat-form-field>

        <mat-form-field  appearance="fill" class="form-group" [formGroup]="passwordForm">
          <mat-label for="password2">Répétez votre mot de passe :</mat-label>
          <input matInput [type]="hidePassword2 ? 'password' : 'text'" 
            class="input-text" id="password2" 
            formControlName="password2"
          >
          <mat-icon matSuffix (click)="hidePassword2 = !hidePassword2">
            {{hidePassword2 ? 'visibility_off' : 'visibility'}}
          </mat-icon>
          <mat-error>Ce champ est requis</mat-error>
        </mat-form-field>
        <small class="error-text" *ngIf="showPasswordsError$ | async">
          Les mots de passe doivent correspondre et respecter les règles
        </small>
      </ng-template>



      <div class="action-buttons">
        <button mat-raised-button 
          color="primary"
          type="submit" 
          [disabled] = "signUpForm.invalid"
        >{{ buttonValue }}</button>
      </div>
      
      <div class="error-message-node">
        <p *ngIf="errorMessageIdentifiant">Les identifiants ne correspondent pas</p>
        <p *ngIf="errorMessageEmailExistant">Cet adresse email est déjà dans la base.<br />
          Réinitialiser le mot de passe n'est pas encore réalisable, mais ce serait l'envoi d'un mail 
          contenant un lien vers ce même formulaire d'inscription avec l'adresse mail bloquée. la CNIL ne veut 
          plus de mot de passe via mail.
        </p>
      </div>

    </form>

  </div>

  <p class="p-footer">
    Vous pouvez voir le code du composant 
    <a href="https://github.com/juannitoo/angular-practice/tree/main/src/app/auth/components/login" 
      target="_blank">ici</a>, celui du service d'authentification 
    <a href="https://github.com/juannitoo/angular-practice/blob/main/src/app/core/services/auth.service.ts"
      target="_blank">là</a>, et enfin celui du controller Node 
    <a href="https://github.com/juannitoo/angular-practice-node-backend/blob/master/controllers/users.js"
      target="_blank">ici</a>.
  </p>

</section>
